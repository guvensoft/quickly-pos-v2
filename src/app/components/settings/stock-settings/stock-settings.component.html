<ul class="nav nav-tabs nav-justified" id="reportTab" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" data-toggle="tab" href="#menu" role="tab">
      <i class="fa fa-book" aria-hidden="true"></i> Kategoriler</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#products" role="tab">
      <i class="fa fa-archive" aria-hidden="true"></i> Stoklar</a>
  </li>
  <li class="nav-item">
    <a class="nav-link disabled" data-toggle="tab" href="#occations" role="tab">
      <i class="fa fa-truck" aria-hidden="true"></i> Tedarik</a>
  </li>
  <li class="nav-item">
    <a class="nav-link disabled" data-toggle="tab" href="#occations" role="tab">
      <i class="fa fa-industry" aria-hidden="true"></i> Depo</a>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="menu" role="tabpanel">
    <div class="card ntb">
      <div class="card-header">
        <div class="row">
          <div class="col-lg-8">
            <h5 class="mt-2">Stok Kategori Ayarları</h5>
          </div>
          <div class="col-lg-4 pr-2 pl-0">
            <button class="btn btn-danger btn-md btn-block" (click)="setDefaultCategory()">
              <i class="fa fa-plus"></i> Kategori Ekle
            </button>
          </div>
        </div>
      </div>
      <div class="card-body tab-height p-0">
        <div class="row">
          <div class="col-lg-3 pr-0">
            <div class="card tab-inside-height">
              <div class="card-header">
                Kategoriler
              </div>
              <div class="card-body p-0 flow">
                <div class="list-group">
                  @for (cat of categories(); track cat._id) {
                  <div class="btn-group btn-group-justify">
                    <button (click)="getStockCatDetail(cat)"
                      [ngClass]="{'list-group-item-warning' : selectedCat() === cat}" type="button"
                      class="list-group-item list-group-item-action">{{cat.name}}</button>
                  </div>
                  }
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-9 pl-0">
            <form #stockCatDetailForm="ngForm" (ngSubmit)="updateCategory(stockCatDetailForm)">
              <div class="card tab-inside-height">
                <div class="card-header">
                  Ayrıntılar
                </div>
                <div class="card-body p-2 flow">
                  @if (selectedCat() === undefined) {
                  <h1 class="text-center mt-5">Listeden Kategori Seçiniz</h1>
                  }
                  <section [hidden]="selectedCat() === undefined">
                    <input type="hidden" name="_id" ngModel>
                    <input type="hidden" name="_rev" ngModel>
                    <div class="form-group mb-2">
                      <div class="input-group">
                        <div class="input-group-prepend">
                          <div class="input-group-text">
                            Kategori Adı
                          </div>
                        </div>
                        <input type="text" name="name" class="form-control form-control-lg" ngModel>
                      </div>
                    </div>
                    <div class="form-group mb-2">
                      <div class="input-group">
                        <div class="input-group-prepend">
                          <div class="input-group-text">
                            Açıklama
                          </div>
                        </div>
                        <input type="text" name="description" class="form-control form-control-lg" ngModel>
                      </div>
                    </div>
                  </section>
                </div>
                <div class="card-footer" [hidden]="selectedCat() === undefined">
                  @if (selectedCat(); as cat) {
                  <div class="row">
                    <div class="col-lg-6 pr-1">
                      <button type="button" (click)="removeCategory(cat._id!)" class="btn btn-danger btn-md btn-block">
                        <i class="fa fa-times" aria-hidden="true"></i> Kategoriyi Sil</button>
                    </div>
                    <div class="col-lg-6 pl-1">
                      <button type="submit" class="btn btn-success btn-md btn-block">
                        <i class="fa fa-check" aria-hidden="true"></i> Değişiklikleri Kaydet</button>
                    </div>
                  </div>
                  }
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <i class="fa fa-question-circle" aria-hidden="true"></i> Yardım
      </div>
    </div>
  </div>
  <div class="tab-pane" id="products" role="tabpanel">
    <div class="card ntb">
      <div class="card-header">
        <div class="row">
          <div class="col-lg-8">
            <h5 class="mt-2">Stoklar</h5>
          </div>
          <div class="col-lg-4 pr-2 pl-0">
            <button [disabled]="categories() === undefined || categories().length === 0"
              class="btn btn-danger btn-md btn-block" (click)="setDefaultStock()">
              <i class="fa fa-plus"></i> Stok Ekle
            </button>
          </div>
        </div>
      </div>
      <div class="card-body tab-height p-0">
        <div class="row">
          <div class="col-xl-3 col-lg-3 pr-0">
            <div class="card tab-inside-height">
              <div class="card-header">
                Kategoriler
              </div>
              <div class="card-body p-0 flow">
                <div class="list-group">
                  <button (click)="fillData()" type="button" class="list-group-item list-group-item-action">Bütün
                    Stoklar</button>
                  @for (cat of categories(); track cat._id) {
                  <button (click)="getStocks(cat._id!)" type="button"
                    class="list-group-item list-group-item-action">{{cat.name}}</button>
                  }
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-9 col-lg-9 pl-0">
            <div class="card tab-inside-height">
              <div class="card-header pt-2 pb-2">
                <div class="row">
                  <div class="col-lg-6 pt-1 pr-0">
                    Stoklar
                  </div>
                  <div class="col-lg-6 pl-0 pr-2">
                    <div class="input-group input-group-sm">
                      <div class="input-group-prepend normal">
                        <div class="input-group-text">
                          <i class="fa fa-search" aria-hidden="true"></i>
                        </div>
                      </div>
                      <input #stockName type="text" placeholder="Stok Adı Giriniz.." (focus)="fillData()"
                        (click)="stockName.value = '';" (keydown)="filterStocks(stockName.value)"
                        class="form-control form-contol-sm">
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-body flow p-0">
                <section>
                  @if (stocks().length > 0) {
                  <table class="table  table-bordered table-dark table-striped table-hover">
                    <thead class="thead-dark">
                      <tr>
                        <th width="6%">#</th>
                        <th width="29%">Stok</th>
                        <th colspan="2" width="30%">Son Giriş</th>
                        <th colspan="3" width="35%">Kalan Miktar</th>
                      </tr>
                    </thead>
                    <tbody>
                      @for (item of stocks(); track item._id; let i = $index) {
                      <tr (click)="getStockDetail(item);">
                        <td>{{i+1}}</td>
                        <td>{{item.name}}</td>
                        <td>{{item.first_quantity}}x</td>
                        <td>{{item.total}} {{item.unit}}</td>
                        <td>{{item.quantity | number:'1.0-2'}}x</td>
                        <td>{{item.left_total | number:'1.0-2'}}</td>
                        <td>{{item.unit}}</td>
                      </tr>
                      }
                    </tbody>
                  </table>
                  }
                  @if (stocks().length === 0) {
                  <div class="row mt-5">
                    <div class="col-lg-12 mt-5">
                      <h2 class="text-center mt-3">Eşleşen Stok Bulunamadı</h2>
                    </div>
                  </div>
                  }
                </section>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <i class="fa fa-question-circle" aria-hidden="true"></i> Yardım
      </div>
    </div>
  </div>
  <div class="tab-pane" id="occations" role="tabpanel">
    <div class="card ntb">
      <div class="card-header">
        <h5 class="mt-2">Stok Ayarları</h5>
      </div>
      <div class="card-body tab-height flow">

      </div>
      <div class="card-footer">
        <i class="fa fa-question-circle" aria-hidden="true"></i> Yardım
      </div>
    </div>
  </div>
</div>