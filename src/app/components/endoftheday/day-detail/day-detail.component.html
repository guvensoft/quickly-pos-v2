<div class="row">
  <div class="col-xl-3 col-lg-3 pr-0">
    <div class="card" style="height:625px">
      <div class="card-header p-1 text-center">
        <small>Başlıklar</small>
      </div>
      <div class="card-body p-0">
        <div class="list-group">
          <button (click)="currentSection.set(undefined); detailTitle.set('Genel Detaylar & Grafik');"
            [ngClass]="{'list-group-item-warning' : currentSection() === undefined}" type="button"
            class="list-group-item list-group-item-action">
            <i class="fa fa-pie-chart fa-2x" aria-hidden="true"></i>
            <span>Genel Detaylar</span>
          </button>
          <button (click)="filterOldData('Checks','All')"
            [ngClass]="{'list-group-item-warning' : currentSection() === 'Checks'}" type="button"
            class="list-group-item list-group-item-action">
            <i class="fa fa-sticky-note fa-2x" aria-hidden="true"></i>
            <span>Hesap Detayları</span>
          </button>
          <button (click)="filterOldData('Cashbox','All')"
            [ngClass]="{'list-group-item-warning' : currentSection() === 'Cashbox'}" type="button"
            class="list-group-item list-group-item-action">
            <i class="fa fa-money fa-2x" aria-hidden="true"></i>
            <span>Kasa Detayları</span>
          </button>
          <button (click)="filterOldData('Products','All')"
            [ngClass]="{'list-group-item-warning' : currentSection() === 'Products'}" type="button"
            class="list-group-item list-group-item-action">
            <i class="fa fa-glass fa-2x" aria-hidden="true"></i>
            <span>Ürün Raporları</span>
          </button>
          <button (click)="filterOldData('Users','All')"
            [ngClass]="{'list-group-item-warning' : currentSection() === 'Users'}" type="button"
            class="list-group-item list-group-item-action">
            <i class="fa fa-user fa-2x" aria-hidden="true"></i>
            <span>Kullanıcı Raporları</span>
          </button>
          <button (click)="filterOldData('Tables','All')"
            [ngClass]="{'list-group-item-warning' : currentSection() === 'Tables'}" type="button"
            class="list-group-item list-group-item-action">
            <i class="fa fa-square fa-2x" aria-hidden="true"></i>
            <span>Masa Raporları</span>
          </button>
          <button (click)="filterOldData('Activity','All')"
            [ngClass]="{'list-group-item-warning' : currentSection() === 'Activity'}" type="button"
            class="list-group-item list-group-item-action">
            <i class="fa fa-line-chart fa-2x" aria-hidden="true"></i>
            <span>Aktivite Grafiği</span>
          </button>
          <button (click)="filterOldData('Logs','All')"
            [ngClass]="{'list-group-item-warning' : currentSection() === 'Logs'}" type="button"
            class="list-group-item list-group-item-action">
            <i class="fa fa-bell fa-2x" aria-hidden="true"></i>
            <span>Sistem Kayıtları</span>
          </button>
          <button (click)="printEndday()" type="button" class="list-group-item list-group-item-action">
            <i class="fa fa-print fa-2x" aria-hidden="true"></i>
            <span>Yazdır</span>
          </button>
        </div>
      </div>
      <div class="card-footer p-1 text-center">
        @if (oldBackupData().length === 0) {
        <small>
          <i class="fa fa-refresh fa-spin" aria-hidden="true"></i> Veriler Senkorinize Ediliyor
        </small>
        }
        @if (syncStatus() && oldBackupData().length > 0) {
        <small class="text-success">
          <i class="fa fa-check" aria-hidden="true"></i> Senkorinize Edildi
        </small>
        }
        @if (!syncStatus() && oldBackupData().length > 0) {
        <small class="text-danger">
          <i class="fa fa-times" aria-hidden="true"></i> Senkorinize Edilemedi
        </small>
        }
      </div>
    </div>
  </div>
  <div class="col-xl-9 col-lg-9 pl-0">
    <div class="card" style="height:625px">
      <div class="card-header p-1 text-center">
        <small> {{detailTitle()}}</small>
      </div>
      @if (currentSection() === 'Checks') {
      <div class="card-header pt-1 pb-1 text-center">
        <div class="row">
          <div class="col pl-0 pr-1">
            <button (click)="filterOldData('Checks','Parçalı')" class="btn btn-primary btn-block">Parçalı</button>
          </div>
          <div class="col pr-1 pl-1">
            <button (click)="filterOldData('Checks','Nakit')" class="btn btn-success btn-block">Nakit</button>
          </div>
          <div class="col pr-1 pl-1">
            <button (click)="filterOldData('Checks','Kart')" class="btn btn-warning btn-block">Kart</button>
          </div>
          <div class="col pr-1 pl-1">
            <button (click)="filterOldData('Checks','Kupon')" class="btn btn-info btn-block">Kupon</button>
          </div>
          <div class="col pl-1 pr-0">
            <button (click)="filterOldData('Checks','İkram')" class="btn btn-danger btn-block">İkram</button>
          </div>
        </div>
      </div>
      }
      @if (currentSection() === 'Cashbox') {
      <div class="card-header pt-1 pb-1 text-center">
        <div class="row">
          <div class="col pl-0 pr-1">
            <button (click)="filterOldData('Cashbox','Gelir')" class="btn btn-success btn-block">Kasa Gelirleri</button>
          </div>
          <div class="col pl-1 pr-0">
            <button (click)="filterOldData('Cashbox','Gider')" class="btn btn-danger btn-block">Kasa Giderleri</button>
          </div>
        </div>
      </div>
      }
      <div class="card-body flow p-0">
        <div class="row">
          <div class="col-lg-12">
            @if (currentSection() === undefined) {
            <section id="chart" class="p-0">
              <div class="row">
                <div class="col-xl-5 col-lg-6 pr-0">
                  <strong>
                    <table class="table table-striped table-hover mb-0">
                      <tbody>
                        <tr (click)="currentSection.set(undefined)">
                          <td width="13%">
                            <i class="fa fa-check" aria-hidden="true"></i>
                          </td>
                          <td width="57%">Genel Toplam:</td>
                          <td width="30%">{{detailData().total_income | price}}</td>
                        </tr>
                        <tr class="text-muted" (click)="filterOldData('Checks','All')">
                          <td>
                            <i class="fa fa-sticky-note" aria-hidden="true"></i>
                          </td>
                          <td>Toplam Hesap Sayısı:</td>
                          <td>{{detailData().check_count}} Adet</td>
                        </tr>
                        <tr class="text-success">
                          <td width="4%">
                            <i class="fa fa-money" aria-hidden="true"></i>
                          </td>
                          <td width="60%">Nakit Hesap Toplamı:</td>
                          <td>{{detailData().cash_total | price}} </td>
                        </tr>
                        <tr class="text-warning" (click)="filterOldData('Checks','Kart')">
                          <td>
                            <i class="fa fa-credit-card" aria-hidden="true"></i>
                          </td>
                          <td>Kart Hesap Toplamı:</td>
                          <td>{{detailData().card_total | price}} </td>
                        </tr>
                        <tr class="text-info" (click)="filterOldData('Checks','Kupon')">
                          <td>
                            <i class="fa fa-bookmark ml-1" aria-hidden="true"></i>
                          </td>
                          <td>Kupon Hesap Toplamı:</td>
                          <td>{{detailData().coupon_total | price}} </td>
                        </tr>
                        <tr class="text-danger" (click)="filterOldData('Checks','İkram')">
                          <td>
                            <i class="fa fa-handshake-o" aria-hidden="true"></i>
                          </td>
                          <td>İkram Hesap Toplamı:</td>
                          <td>{{detailData().free_total | price}} </td>
                        </tr>
                        <tr class="text-primary" (click)="filterOldData('Checks','İptal')">
                          <td>
                            <i class="fa fa-times-rectangle" aria-hidden="true"></i>
                          </td>
                          <td>İptal Hesap Toplamı:</td>
                          <td>{{detailData().canceled_total | price}} </td>
                        </tr>
                        <tr (click)="filterOldData('Cashbox','Gelir')">
                          <td>
                            <i class="fa fa-arrow-down" aria-hidden="true"></i>
                          </td>
                          <td>Kasa Geliri Toplamı:</td>
                          <td>{{detailData().incomes | price}} </td>
                        </tr>
                        <tr (click)="filterOldData('Cashbox','Gider')">
                          <td>
                            <i class="fa fa-arrow-up" aria-hidden="true"></i>
                          </td>
                          <td>Kasa Gideri Toplamı:</td>
                          <td>{{detailData().outcomes | price}} </td>
                        </tr>
                        <tr>
                          <td>
                            <i class="fa fa-user" aria-hidden="true"></i>
                          </td>
                          <td>Kullanıcı:</td>
                          <td>{{detailData().owner | general:'users' | async}}</td>
                        </tr>
                        <tr>
                          <td>
                            <i class="fa fa-calendar" aria-hidden="true"></i>
                          </td>
                          <td>Tarih:</td>
                          <td>{{detailData().timestamp | date:'d/M/y'}}</td>
                        </tr>
                        <tr>
                          <td>
                            <i class="fa fa-clock-o" aria-hidden="true"></i>
                          </td>
                          <td>Saat:</td>
                          <td>{{detailData().timestamp | date:'HH:mm'}}</td>
                        </tr>
                      </tbody>
                    </table>
                  </strong>
                </div>
                <div class="col-xl-7 col-lg-6 pt-4 pl-0">
                  <canvas baseChart [datasets]="pieData()" [labels]="pieLabels()" [options]="pieOptions()" [legend]="true"
                    [type]="'pie'" (chartHover)="chartHovered($event)" (chartClick)="chartClicked($event)"></canvas>
                </div>
              </div>
            </section>
            }
            @if (currentSection() === 'Checks') {
            <section id="checks">
              <table class="table table-striped table-hover  table-bordered mb-0">
                <thead class="thead-dark">
                  <tr>
                    <th width="8%">#</th>
                    <th width="32%">Hesap</th>
                    <th width="15%">Kullanıcı</th>
                    <th width="20%">Tutar</th>
                    <th width="15%">Ödeme</th>
                    <th width="10%">Saat</th>
                  </tr>
                </thead>
                <tbody>
                  @for (item of checksTable(); track $index; let i = $index) {
                  <tr (click)="showCheckDetail(item)">
                    <td>{{i+1}}</td>
                    <td>{{item.table_id | general:'tables' | async}}
                      @if (item.note !== '' && item.note !== undefined) {
                      <small class="text-muted">({{item.note}})</small>
                      }
                    </td>
                    <td>{{item.owner}}</td>
                    <td>{{item.total_price | price}}
                      @if (item.discount !== 0) {
                      <small class="text-danger pull-right">
                        <i class="fa fa-arrow-down" aria-hidden="true"></i> <b>{{item.discount | price}}</b></small>
                      }
                    </td>
                    <td>{{item.payment_method}}</td>
                    <td>{{item.timestamp | date:'HH:mm'}}</td>
                  </tr>
                  }
                </tbody>
              </table>
            </section>
            }
            @if (currentSection() === 'Cashbox') {
            <section id="cashbox">
              <table class="table  table-bordered table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th width="8%">#</th>
                    <th width="43%">Açıklama</th>
                    <th width="20%">Kullanıcı</th>
                    <th width="20%">Tutar</th>
                    <th width="11%">Saat</th>
                  </tr>
                </thead>
                <tbody>
                  @for (cash of cashboxTable(); track $index; let i = $index) {
                  <tr (click)="showCashDetail(cash)"
                    [ngClass]="{'table-danger': cash.type === 'Gider', 'table-success': cash.type === 'Gelir'}">
                    <td>{{i+1}}</td>
                    <td>{{cash.description}}</td>
                    <td>{{cash.user}}</td>
                    <td>{{cash.cash + cash.card + cash.coupon | price}} </td>
                    <td>{{cash.timestamp | date:'HH:mm'}}</td>
                  </tr>
                  }
                </tbody>
              </table>
            </section>
            }
            @if (currentSection() === 'Products') {
            <section id="products">
              <table class="table table-sm  table-bordered table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th width="5%">#</th>
                    <th width="40%">Ürün</th>
                    <th width="15%">Yüzde</th>
                    <th width="15%">Tutarı</th>
                    <th width="15%">Adet</th>
                    <th width="10%">Saat</th>
                  </tr>
                </thead>
                <tbody>
                  @for (product of productsTable(); track $index; let i = $index) {
                  <tr>
                    <td class="text-center">{{i+1}}</td>
                    <td>{{product.connection_id | general:'products' | async}}</td>
                    <td><strong>% {{(product.weekly[detailDay()]/detailData().total_income) * 100 | number:'1.0-2'
                        }}</strong></td>
                    <td>{{product.weekly[detailDay()] | price }} </td>
                    <td>{{product.weekly_count[detailDay()]}} Adet</td>
                    <td>{{product.timestamp | date:'HH:mm'}}</td>
                  </tr>
                  }
                </tbody>
              </table>
            </section>
            }
            @if (currentSection() === 'Users') {
            <section id="users">
              <table class="table  table-bordered table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th width="8%">#</th>
                    <th width="37%">Kullanıcı</th>
                    <th width="15%">Yüzde</th>
                    <th width="15%">Tutar</th>
                    <th width="15%">Adet</th>
                    <th width="10%">Saat</th>
                  </tr>
                </thead>
                <tbody>
                  @for (user of usersTable(); track $index; let i = $index) {
                  <tr>
                    <td>{{i+1}}</td>
                    <td>{{user.connection_id | general:'users' | async}}</td>
                    <td><strong>% {{(user.weekly[detailDay()]/detailData().total_income) * 100 | number:'1.0-2' }}</strong>
                    </td>
                    <td>{{user.weekly[detailDay()] | price }} </td>
                    <td>{{user.weekly_count[detailDay()]}} Adet</td>
                    <td>{{user.timestamp | date:'HH:mm'}}</td>
                  </tr>
                  }
                </tbody>
              </table>
            </section>
            }

            @if (currentSection() === 'Tables') {
            <section id="tables">
              <table class="table  table-bordered table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th width="8%">#</th>
                    <th width="37%">Masa</th>
                    <th width="15%">Yüzde</th>
                    <th width="15%">Tutar</th>
                    <th width="15%">Adet</th>
                    <th width="10%">Saat</th>
                  </tr>
                </thead>
                <tbody>
                  @for (table of tablesTable(); track $index; let i = $index) {
                  <tr>
                    <td>{{i+1}}</td>
                    <td>{{table.connection_id | general:'tables' | async}}</td>
                    <td><strong>% {{(table.weekly[detailDay()]/detailData().total_income) * 100 | number:'1.0-2'}}</strong>
                    </td>
                    <td>{{table.weekly[detailDay()] | price }} </td>
                    <td>{{table.weekly_count[detailDay()]}} Adet</td>
                    <td>{{table.timestamp | date:'HH:mm'}}</td>
                  </tr>
                  }
                </tbody>
              </table>
            </section>
            }
            @if (currentSection() === 'Activity') {
            <section id="activity">
              <canvas baseChart [datasets]="activityData()" [labels]="activityLabels()" [options]="activityOptions()"
                [legend]="true" [type]="'line'" (chartHover)="chartHovered($event)"
                (chartClick)="chartClicked($event)"></canvas>
            </section>
            }
            @if (currentSection() === 'Logs') {
            <section id="logs">
              <table class="table  table-bordered table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th width="8%">#</th>
                    <th width="62%">Açıklama</th>
                    <th width="20%">Kullanıcı</th>
                    <th width="10%">Saat</th>
                  </tr>
                </thead>
                <tbody>
                  @for (log of logsTable(); track $index; let i = $index) {
                  <tr>
                    <td>{{i+1}}</td>
                    <td>{{log.description}}</td>
                    <td>{{log.user}}</td>
                    <td>{{log.timestamp | date:'HH:mm'}}</td>
                  </tr>
                  }
                </tbody>
              </table>
            </section>
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="checkDetail" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-md" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Hesap Detayı
        </h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-0">
        <div class="card checkDetail">
          <div class="card-header">
            <b>{{checkDetail()?.table_id | general:'tables' | async}}
              <small class="text-muted"> ({{checkDetail()?.timestamp | date:'dd/M/y HH:mm'}})</small>
            </b>
            <span class="pull-right text-muted"> Hesap Türü : {{checkDetail()?.payment_method}}</span>
          </div>
          <div class="card-body flow p-0">
            @if (checkDetail()?.payment_method !== 'Parçalı') {
            <table class="table table-striped table-sm  table-bordered mb-0">
              <thead class="thead-dark">
                <th width="8%">#</th>
                <th width="46%">Ürün</th>
                <th width="17%">Garson</th>
                <th width="14%">Saat</th>
                <th width="14%">Fiyat</th>
              </thead>
              <tbody>
                @for (item of checkDetail()?.products || []; track $index; let i = $index) {
                <tr
                  [ngClass]="{'table-danger': item.status === 3}">
                  <td>{{i+1}}</td>
                  <td>{{item.name}}
                    @if (item.note !== '' && item.note !== undefined) {
                    <small class="text-muted">({{item.note}})</small>
                    }
                  </td>
                  <td>{{item.owner | general:'users' | async}}</td>
                  <td>{{item.timestamp |date:'HH:mm'}}</td>
                  <td>{{item.price | price}} </td>
                </tr>
                }
              </tbody>
            </table>
            }
            @if (checkDetail()?.payment_method === 'Parçalı') {
            <section>
              @for (item of checkDetail()?.payment_flow || []; track $index; let i = $index) {
              <table
                class="table table-sm  table-bordered table-striped mb-0">
                <thead class="thead-dark">
                  <th width="8%">#</th>
                  <th width="44%">{{item.owner}}</th>
                  <th width="15%">{{item.method}}</th>
                  <th width="15%">{{item.timestamp | date:'HH:mm'}}</th>
                  <th width="17%">{{item.amount + item.discount | price }} </th>
                </thead>
                <tbody>
                  @if (item.discount > 0) {
                  <tr class="table-info">
                    <td width="5%"><i class="fa fa-arrow-down" aria-hidden="true"></i></td>
                    <td width="46%" colspan="3">İndirim Tutarı</td>
                    <td width="17%">{{item.discount | price }} </td>
                  </tr>
                  }
                  @for (product of item.payed_products || []; track $index; let j = $index) {
                  <tr
                    [ngClass]="{'table-danger': product.status === 3}">
                    <td>{{j+1}}</td>
                    <td>{{product.name}}
                      @if (product.note !== '' && product.note !== undefined) {
                      <small class="text-muted">({{product.note}})</small>
                      }
                    </td>
                    <td>{{product.owner | general:'users' | async}}</td>
                    <td>{{product.timestamp |date:'HH:mm'}}</td>
                    <td>{{product.price | price}} </td>
                  </tr>
                  }
                </tbody>
              </table>
              }
            </section>
            }
          </div>
          <div class="card-footer">
            <b>
              <i class="fa fa-user mr-1" aria-hidden="true"></i> Kullanıcı:
              <span class="pull-right">{{checkDetail()?.owner}}</span>
            </b>
          </div>
          @if ((checkDetail()?.discount || 0) > 0) {
          <div class="card-footer">
            <b>
              <i class="fa fa-arrow-down" aria-hidden="true"></i> Toplam İndirim Tutarı:
              <span class="pull-right">{{checkDetail()?.discount || 0 | price }} </span>
            </b>
          </div>
          }
          <div class="card-footer">
            <b>
              <i class="fa fa-check" aria-hidden="true"></i> Ödenen Miktar:
              <span class="pull-right">{{checkDetail()?.total_price || 0 | price }} </span>
            </b>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-lg" data-dismiss="modal" aria-label="Close">Kapat</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="cashDetail" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="modelTitleId">{{cashDetail()?.type}} Hareketi</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-0">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">{{cashDetail()?.description}}</h5>
          </div>
          <div class="card-body p-0">
            <strong>
              <table class="table table-striped mb-0">
                <tbody>
                  <tr class="table-success">
                    <td width="10%">
                      <i class="fa fa-money" aria-hidden="true"></i>
                    </td>
                    <td>Nakit:</td>
                    <td width="20%">
                      <span class="pull-right">{{cashDetail()?.cash || 0 | price }} </span>
                    </td>
                  </tr>
                  <tr class="table-warning">
                    <td width="10%">
                      <i class="fa fa-credit-card" aria-hidden="true"></i>
                    </td>
                    <td>Kart:</td>
                    <td width="20%">
                      <span class="pull-right">{{cashDetail()?.card || 0 | price }} </span>
                    </td>
                  </tr>
                  <tr class="table-info">
                    <td width="10%">
                      <i class="fa fa-bookmark ml-1" aria-hidden="true"></i>
                    </td>
                    <td>Kupon:</td>
                    <td width="20%">
                      <span class="pull-right">{{cashDetail()?.coupon || 0 | price }} </span>
                    </td>
                  </tr>
                  <tr>
                    <td width="10%">
                      <i class="fa fa-check" aria-hidden="true"></i>
                    </td>
                    <td>Toplam:</td>
                    <td width="20%">
                      <span class="pull-right">{{(cashDetail()?.coupon || 0) + (cashDetail()?.cash || 0) + (cashDetail()?.card
                        || 0) |
                        price
                        }} </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </strong>
          </div>
          <div class="card-footer">
            <i class="fa fa-user" aria-hidden="true"></i> {{cashDetail()?.user}}
            <span class="pull-right">
              {{cashDetail()?.timestamp | date:'HH:mm'}}
            </span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-lg" data-dismiss="modal">Kapat</button>
      </div>
    </div>
  </div>
</div>