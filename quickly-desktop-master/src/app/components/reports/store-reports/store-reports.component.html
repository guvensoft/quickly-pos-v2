<ul class="nav nav-tabs nav-justified" id="reportTab" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" data-toggle="tab" href="#normal" role="tab">
      <i class="fa fa-th" aria-hidden="true"></i> Normal Satış</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#fast" role="tab">
      <i class="fa fa-clock-o" aria-hidden="true"></i> Hızlı Satış</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#delivery" role="tab">
      <i class="fa fa-motorcycle" aria-hidden="true"></i> Paket Servis
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#canceled" role="tab">
      <i class="fa fa-trash-o" aria-hidden="true"></i> İptal</a>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="normal" role="tabpanel">
    <div class="card ntb">
      <div class="card-header">
        <h5 class="mt-2">Normal Satış</h5>
      </div>
      <div class="card-body tab-height p-0">
        <div class="row">
          <div class="col-lg-3 pr-0">
            <div class="card tab-inside-height">
              <div class="card-header">Filtreleme</div>
              <div class="card-body p-0">
                <div class="list-group">
                  <button type="button" (click)="fillData()" class="list-group-item list-group-item-action list-eq">Bütün
                    Masalar</button>
                  <button type="button" (click)="getNormalChecksBy('Parçalı')" class="list-group-item list-group-item-action bg-primary text-white list-eq">Parçalı</button>
                  <button type="button" (click)="getNormalChecksBy('Nakit')" class="list-group-item list-group-item-action list-group-item-success list-eq">Nakit</button>
                  <button type="button" (click)="getNormalChecksBy('Kart')" class="list-group-item list-group-item-action list-group-item-warning list-eq">Kart</button>
                  <button type="button" (click)="getNormalChecksBy('Kupon')" class="list-group-item list-group-item-action list-group-item-info list-eq">Kupon</button>
                  <button type="button" (click)="getNormalChecksBy('İkram')" class="list-group-item list-group-item-action list-group-item-danger list-eq">İkram</button>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-9 pl-0">
            <div class="card tab-inside-height">
              <div class="card-header pb-2 pt-2">
                <div class="row">
                  <div class="col-lg-6 pt-1">
                    Masalar
                  </div>
                  <div class="col-lg-6 pr-2">
                    <div class="input-group input-group-sm">
                      <div class="input-group-prepend normal">
                        <div class="input-group-text">
                          <i class="fa fa-search" aria-hidden="true"></i>
                        </div>
                      </div>
                      <input #tableName type="text" placeholder="Masa Adı Giriniz.." (click)="fillData(); tableName.value = '';" (keyup)="filterTables(tableName.value)" class="form-control form-contol-sm">
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-body p-0 flow">
                <table class="table  table-bordered table-striped table-hover">
                  <thead class="thead-dark">
                    <tr>
                      <th width="7%">#</th>
                      <th width="25%">Masa</th>
                      <th width="27%">Tutar</th>
                      <th width="13%">Saat</th>
                      <th width="17%">Ödeme</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let check of NormalChecks let i = index;" (click)="getDetail(check)">
                      <td>{{i+1}}</td>
                      <td>{{check.table_id | general:'tables' | async}}
                        <small *ngIf="check.note !== '' && check.note !== undefined" class="text-muted">({{check.note}})</small>
                      </td>
                      <td>{{check.total_price + check.discount | price}}
                        <small *ngIf="check.discount > 0" class="pull-right text-danger">
                          <strong>
                            <i class="fa fa-arrow-down" aria-hidden="true"></i> {{check.discount |  price}}
                          </strong>
                        </small>
                      </td>
                      <td>{{check.timestamp | date:"HH:mm" }}</td>
                      <td>{{check.payment_method}}</td>
                    </tr>
                  </tbody>
                </table>
                <h3 *ngIf="NormalChecks == undefined || NormalChecks.length == 0" class="text-center mt-5">Eşleşen
                  Hesap Bulunamadı</h3>
              </div>
              <div class="card-footer">
                <strong>
                  Normal Hesap Toplamı:
                  <span class="pull-right">{{NormalTotal | price }} </span>
                </strong>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <i class="fa fa-question-circle" aria-hidden="true"></i> Yardım
      </div>
    </div>
  </div>
  <div class="tab-pane" id="fast" role="tabpanel">
    <div class="card ntb">
      <div class="card-header">
        <h5 class="mt-2">Hızlı Satış</h5>
      </div>
      <div class="card-body tab-height p-0">
        <div class="row">
          <div class="col-lg-3 pr-0">
            <div class="card tab-inside-height">
              <div class="card-header">Filtreleme</div>
              <div class="card-body p-0">
                <div class="list-group">
                  <button type="button" (click)="fillData()" class="list-group-item list-group-item-action list-eq">Bütün
                    Hesaplar</button>
                  <button type="button" (click)="getFastChecksBy('Parçalı')" class="list-group-item list-group-item-action bg-primary text-white list-eq">Parçalı</button>
                  <button type="button" (click)="getFastChecksBy('Nakit')" class="list-group-item list-group-item-action list-group-item-success list-eq">Nakit</button>
                  <button type="button" (click)="getFastChecksBy('Kart')" class="list-group-item list-group-item-action list-group-item-warning list-eq">Kart</button>
                  <button type="button" (click)="getFastChecksBy('Kupon')" class="list-group-item list-group-item-action list-group-item-info list-eq">Kupon</button>
                  <button type="button" (click)="getFastChecksBy('İkram')" class="list-group-item list-group-item-action list-group-item-danger list-eq">İkram</button>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-9 pl-0">
            <div class="card tab-inside-height">
              <div class="card-header pt-2 pb-2">
                <div class="row">
                  <div class="col-lg-6 pt-1">
                    Hesaplar
                  </div>
                  <div class="col-lg-6 pr-2">
                    <div class="input-group input-group-sm">
                      <div class="input-group-prepend normal">
                        <div class="input-group-text">
                          <i class="fa fa-search" aria-hidden="true"></i>
                        </div>
                      </div>
                      <input #ownerName type="text" placeholder="Kullanıcı Adı Giriniz.." (click)="fillData(); ownerName.value = '';" (keyup)="filterChecks(ownerName.value)" class="form-control form-contol-sm">
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-body p-0 flow">
                <table class="table  table-bordered table-striped table-hover">
                  <thead class="thead-dark">
                    <tr>
                      <th width="7%">#</th>
                      <th width="33%">Hesap Türü</th>
                      <th width="20%">Tutar</th>
                      <th width="13%">Saat</th>
                      <th width="17%">Kullanıcı</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let check of FastChecks let i = index;" (click)="getDetail(check)">
                      <td>{{i+1}}</td>
                      <td>{{check.table_id}}
                        <small *ngIf="check.note !== '' && check.note !== undefined" class="text-muted">({{check.note}})</small>
                      </td>
                      <td>{{check.total_price + check.discount | price}}
                        <small *ngIf="check.discount > 0" class="pull-right text-danger">
                          <i class="fa fa-arrow-down" aria-hidden="true"></i> {{check.discount | price}}
                        </small>
                      </td>
                      <td>{{check.timestamp | date:"HH:mm" }}</td>
                      <td>{{check.owner}}</td>
                    </tr>
                  </tbody>
                </table>
                <h3 *ngIf="FastChecks == undefined || FastChecks.length == 0" class="text-center mt-5">Eşleşen Hesap
                  Bulunamadı</h3>
              </div>
              <div class="card-footer">
                <strong>
                  Hızlı Hesap Toplamı:
                  <span class="pull-right">{{FastTotal | price }} </span>
                </strong>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <i class="fa fa-question-circle" aria-hidden="true"></i> Yardım
      </div>
    </div>
  </div>
  <div class="tab-pane" id="canceled" role="tabpanel">
    <div class="card ntb">
      <div class="card-header">
        <h5 class="mt-2">İptal Edilen Hesaplar</h5>
      </div>
      <div class="card-body p-0 tab-height flow">
        <div class="row">
          <div class="col-lg-12">
            <table class="table  table-bordered table-striped table-hover">
              <thead>
                <tr class="thead-dark">
                  <th width="6%">#</th>
                  <th width="14%">Masa</th>
                  <th width="25%">Açıklama</th>
                  <th width="10%">Tür</th>
                  <th width="10%">Tutar</th>
                  <th width="10%">Saat</th>
                  <th width="10%">Kullanıcı</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let check of NotPayedChecks let i = index;" (click)="getDetail(check)">
                  <td>{{i+1}}</td>
                  <td>{{check.table_id | general:'tables' | async}}
                    <small *ngIf="check.note !== '' && check.note !== undefined" class="text-muted">({{check.note}})</small>
                  </td>
                  <td>{{check.description}}</td>
                  <td>{{check.payment_method}}</td>
                  <td>{{check.total_price | price }} </td>
                  <td>{{check.timestamp | date:"HH:mm" }}</td>
                  <td>{{check.owner}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <i class="fa fa-question-circle" aria-hidden="true"></i> Yardım
      </div>
    </div>
  </div>
  <div class="tab-pane" id="delivery" role="tabpanel">
    <div class="card ntb">
      <div class="card-header">
        <h5 class="mt-2">Paket Servis</h5>
      </div>
      <div class="card-body tab-height p-0">
        <div class="row">
          <div class="col-lg-3 pr-0">
            <div class="card tab-inside-height">
              <div class="card-header">Filtreleme</div>
              <div class="card-body p-0">
                <div class="list-group">
                  <button type="button" (click)="fillData()" class="list-group-item list-group-item-action list-eq">Bütün
                    Hesaplar</button>
                  <button type="button" (click)="getDeliveryChecksBy('Parçalı')" class="list-group-item list-group-item-action bg-primary text-white list-eq">Parçalı</button>
                  <button type="button" (click)="getDeliveryChecksBy('Nakit')" class="list-group-item list-group-item-action list-group-item-success list-eq">Nakit</button>
                  <button type="button" (click)="getDeliveryChecksBy('Kart')" class="list-group-item list-group-item-action list-group-item-warning list-eq">Kart</button>
                  <button type="button" (click)="getDeliveryChecksBy('Kupon')" class="list-group-item list-group-item-action list-group-item-info list-eq">Kupon</button>
                  <button type="button" (click)="getDeliveryChecksBy('İkram')" class="list-group-item list-group-item-action list-group-item-danger list-eq">İkram</button>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-9 pl-0">
            <div class="card tab-inside-height">
              <div class="card-header pt-2 pb-2">
                <div class="row">
                  <div class="col-lg-6 pt-1">
                    Hesaplar
                  </div>
                  <div class="col-lg-6 pr-2">
                    <div class="input-group input-group-sm">
                      <div class="input-group-prepend normal">
                        <div class="input-group-text">
                          <i class="fa fa-search" aria-hidden="true"></i>
                        </div>
                      </div>
                      <input #ownerName type="text" placeholder="Kullanıcı Adı Giriniz.." (click)="fillData(); ownerName.value = '';" (keyup)="filterChecks(ownerName.value)" class="form-control form-contol-sm">
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-body p-0 flow">
                <table class="table  table-bordered table-striped table-hover">
                  <thead class="thead-dark">
                    <tr>
                      <th width="7%">#</th>
                      <th width="33%">Hesap Türü</th>
                      <th width="20%">Tutar</th>
                      <th width="13%">Saat</th>
                      <th width="17%">Kullanıcı</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let check of DeliveryChecks let i = index;" (click)="getDetail(check)">
                      <td>{{i+1}}</td>
                      <td>{{check.table_id}}
                        <small *ngIf="check.note !== '' && check.note !== undefined" class="text-muted">({{check.note}})</small>
                      </td>
                      <td>{{check.total_price + check.discount | price}}
                        <small *ngIf="check.discount > 0" class="pull-right text-danger">
                          <i class="fa fa-arrow-down" aria-hidden="true"></i> {{check.discount | price}}
                        </small>
                      </td>
                      <td>{{check.timestamp | date:"HH:mm" }}</td>
                      <td>{{check.owner}}</td>
                    </tr>
                  </tbody>
                </table>
                <h3 *ngIf="DeliveryChecks == undefined || DeliveryChecks.length == 0" class="text-center mt-5">Eşleşen Hesap
                  Bulunamadı</h3>
              </div>
              <div class="card-footer">
                <strong>
                  Paket Servis Toplamı:
                  <span class="pull-right">{{DeliveryTotal | price }} </span>
                </strong>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <i class="fa fa-question-circle" aria-hidden="true"></i> Yardım
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="reportDetail" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-md" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-tie" id="modelTieId">Hesap Detayı
        </h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-0">
        <div class="card checkDetail">
          <div class="card-header">
            <b>{{checkDetail?.table_id | general:'tables' | async}}
              <small class="text-muted"> ({{checkDetail?.timestamp | date:'dd/M/y HH:mm'}})</small>
            </b>
            <span class="pull-right text-muted"> Hesap Türü : {{checkDetail?.payment_method}}</span>
          </div>
          <div class="card-body flow p-0">
            <table *ngIf="checkDetail?.payment_method != 'Parçalı'" class="table table-striped  table-bordered table-sm mb-0">
              <thead class="thead-dark">
                <th width="6%">#</th>
                <th width="44%">Ürün</th>
                <th width="17%">Garson</th>
                <th width="14%">Saat</th>
                <th width="17%">Fiyat</th>
              </thead>
              <tbody>
                <tr *ngFor="let item of checkDetail?.products; let i = index;" [ngClass]="{'table-danger': item.status == 3}">
                  <td>{{i+1}}</td>
                  <td>{{item.name}}
                    <small *ngIf="item.note !== '' && item.note !== undefined" class="text-muted">({{item.note}})</small>
                  </td>
                  <td>{{item.owner | general:'users' | async }}</td>
                  <td>{{item.timestamp |date:'HH:mm'}}</td>
                  <td>{{item.price | price}} </td>
                </tr>
              </tbody>
            </table>
            <section *ngIf="checkDetail?.payment_method == 'Parçalı'">
              <table *ngFor="let item of checkDetail?.payment_flow; let i = index;" class="table table-sm  table-bordered table-striped mb-0">
                <thead class="thead-dark">
                  <th width="6%">#</th>
                  <th width="45%">{{item.owner}}</th>
                  <th width="15%">{{item.method}}</th>
                  <th width="15%">{{item.timestamp | date:'HH:mm'}}</th>
                  <th width="17%">{{item.amount + item.discount | price}} </th>
                </thead>
                <tbody>
                  <tr *ngIf="item.discount > 0" class="table-info">
                    <td><i class="fa fa-arrow-down" aria-hidden="true"></i></td>
                    <td colspan="3">İndirim Tutarı</td>
                    <td>{{item.discount | price }} </td>
                  </tr>
                  <tr *ngFor="let product of item.payed_products; let i = index;" [ngClass]="{'table-danger': product.status == 3}">
                    <td width="4%">{{i+1}}</td>
                    <td width="48%">{{product.name}}
                      <small *ngIf="product.note !== '' && product.note !== undefined" class="text-muted">({{product.note}})</small>
                    </td>
                    <td width="15%">{{product.owner | general:'users' | async }}</td>
                    <td width="15%">{{product.timestamp |date:'HH:mm'}}</td>
                    <td width="17%">{{product.price | price}} </td>
                  </tr>
                </tbody>
              </table>
            </section>
          </div>
          <div class="card-footer">
            <b>
              <i class="fa fa-user mr-1" aria-hidden="true"></i> Ziyaretçi:
              <span class="pull-right"><i class="fa fa-male mr-1" aria-hidden="true"></i>{{checkDetail?.occupation?.male || "-" }} <i class="fa fa-female mr-1" aria-hidden="true"></i> {{checkDetail?.occupation?.female || "-"}}</span>
            </b>
          </div>
          <div class="card-footer">
            <b>
              <i class="fa fa-user mr-1" aria-hidden="true"></i> Kullanıcı:
              <span class="pull-right">{{checkDetail?.owner}}</span>
            </b>
          </div>
          <div *ngIf="checkDetail?.discount > 0" class="card-footer">
            <b>
              <i class="fa fa-arrow-down" aria-hidden="true"></i> Toplam İndirim Tutarı:
              <span class="pull-right">{{checkDetail?.discount | price}} </span>
            </b>
          </div>
          <div class="card-footer">
            <b>
              <i class="fa fa-check" aria-hidden="true"></i> Ödenen Miktar:
              <span class="pull-right">{{checkDetail?.total_price | price}} </span>
            </b>
          </div>
        </div>
      </div>
      <div class="modal-footer pr-2 text-center">
        <button *ngIf="checkDetail?.type !== 3" [disabled]="!permissions.cancelCheck" data-toggle="modal" data-dismiss="modal" data-target="#cancelDetail" class="btn btn-danger btn-lg">
          <i class="fa fa-times" aria-hidden="true"></i> İptal Et</button>
        <button (click)="rePrintCheck(checkDetail)" class="btn btn-primary btn-lg">
          <i class="fa fa-print" aria-hidden="true"></i> Yazdır</button>
        <button *ngIf="checkDetail?.type !== 3" [disabled]="!permissions.cancelCheck" type="button" class="btn btn-success btn-lg mr-1" data-toggle="modal" data-dismiss="modal" data-target="#editCheck">
          <i class="fa fa-edit" aria-hidden="true"></i> Hesap Düzelt</button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="checkDetail" class="modal fade" id="cancelDetail" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-tie" id="modelTieId">Hesap İptal Detayı</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="input-group">
          <div class="input-group-prepend">
            <div class="input-group-text">
              İptal Nedeni
            </div>
          </div>
          <input #cancelNote type="text" class="form-control form-control-lg" placeholder="Açıklama Giriniz">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-lg" data-dismiss="modal">Kapat</button>
        <button [disabled]="cancelNote.value == '' || cancelNote.value == ' '" (click)="cancelCheck(checkDetail._id,cancelNote.value)" class="btn btn-danger btn-lg">İptal Et</button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="checkDetail" class="modal fade" id="editCheck" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-md" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-tie" id="modelTieId">Hesap Düzenle</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form #checkEdit="ngForm" (ngSubmit)="editCheck(checkEdit)">
        <div *ngIf="!checkDetail?.payment_flow" class="modal-body">
          <div class="form-group">
            <div class="input-group">
              <div class="input-group-prepend">
                <div class="input-group-text">
                  Hesap Tutarı
                </div>
              </div>
              <input type="number" class="form-control form-control-lg" name="total_price" [ngModel]="checkDetail.total_price">
              <div class="input-group-append">
                <div class="input-group-text"></div>
              </div>
            </div>
          </div>
          <div class="form-group">
            <div class="input-group">
              <div class="input-group-prepend">
                <div class="input-group-text">Hesap Tipi</div>
              </div>
              <select name="payment_method" class="form-control form-control-lg" [ngModel]="checkDetail.payment_method">
                <option>Nakit</option>
                <option>Kart</option>
                <option>Kupon</option>
                <option>İkram</option>
              </select>
            </div>
          </div>
        </div>
        <div *ngIf="checkDetail?.payment_flow" class="modal-body">
          <p>Düzenlemek istediğiniz ödemeyi seçin</p>
          <div *ngFor="let payment of checkDetail?.payment_flow; let i = index">
            <button type="button" class="btn btn-block btn-lg btn-secondary text-left mb-1" (click)="editPayment(i)">{{payment.method}}
              <span class="pull-right">{{payment.amount | price}} </span>
            </button>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" (click)="reOpenCheck(checkDetail)" class="btn btn-info btn-lg" data-dismiss="modal">
            <i class="fa fa-undo"></i>
            Hesabı Geri Aç</button>
          <button *ngIf="!checkDetail?.payment_flow" type="submit" class="btn btn-success btn-lg">
            <i class="fa fa-check" aria-hidden="true"></i> Değişiklikleri Kaydet</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="paymentDetail" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-tie">Ödeme Düzenle</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form #paymentEdit="ngForm" (ngSubmit)="changePayment(paymentEdit)">
        <div class="modal-body">
          <div class="form-group">
            <div class="input-group">
              <div class="input-group-prepend">
                <div class="input-group-text">
                  Ödeme Tutarı
                </div>
              </div>
              <input type="number" class="form-control form-control-lg" name="amount" [ngModel]="selectedPayment?.amount">
              <div class="input-group-append">
                <div class="input-group-text">
                    <i class="fa fa-turkish-lira fa-2x" aria-hidden="true"></i>
                </div>
              </div>
            </div>
          </div>
          <div class="form-group">
            <div class="input-group">
              <div class="input-group-prepend">
                <div class="input-group-text">Ödeme Tipi</div>
              </div>
              <select name="method" class="form-control form-control-lg" [ngModel]="selectedPayment?.method">
                <option>Nakit</option>
                <option>Kart</option>
                <option>Kupon</option>
                <option>İkram</option>
              </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger btn-lg" data-dismiss="modal" data-toggle="modal" data-target="#editCheck">İptal</button>
          <button type="submit" class="btn btn-success btn-lg">
            <i class="fa fa-check"></i> Değiştir</button>
        </div>
      </form>
    </div>
  </div>
</div>
